---
title: "Untitled"
author: "lly"
date: "2025-05-30"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

ğŸ” 1. æ•°æ®æè¿°ä¸é¢„å¤„ç†
```{r }
library(readxl)
library(dplyr)

# è½½å…¥æ•°æ®
data <- read_excel("data//raw//journal.pone.0258761.s010.xlsx")
# å°†Fåˆ—åŠä¹‹åçš„åˆ—è½¬æ¢ä¸ºæ•°å€¼ç±»å‹
data[, 6:ncol(data)] <- sapply(data[, 6:ncol(data)], function(x) as.numeric(as.character(x)))

# æŸ¥çœ‹è½¬æ¢åçš„æ•°æ®
head(data)
# æŸ¥çœ‹åŸºæœ¬ä¿¡æ¯
str(data)
summary(data)
```

ğŸ“Š 2. å•å› ç´ ç»Ÿè®¡åˆ†æï¼ˆANOVA + Tukey HSDï¼‰
ç”¨äºæ¯”è¾ƒ 10 ä¸ª phytogeographic zone ä¹‹é—´å½¢æ€ç‰¹å¾å·®å¼‚ï¼š
```{r }
library(ggplot2)
library(emmeans)

# ç¤ºä¾‹ï¼šå¯¹ withers height è¿›è¡Œæ–¹å·®åˆ†æå’Œå¤šé‡æ¯”è¾ƒ
anova_model <- aov(WH ~ PHZ, data = data)
summary(anova_model)
emmeans(anova_model, pairwise ~ PHZ)  # Tukey HSD å¤šé‡æ¯”è¾ƒ
```
ğŸ“ 3. å½¢æ€æŒ‡æ•°è®¡ç®—ï¼ˆæ ¹æ® Table 3ï¼‰
```{r }
data <- data %>%
  mutate(
    MI = BW * 100 / WH,
    IGS = (WH - CD) / CD,
    IAT = EL / CD,
    USI = (WH - CD) * 100 / WH,
    BI = CC * 100 / HG,
    IP = RW * 100 / RL,
    CDI = CD * 100 / WH,
    SI = WH / BL * 100,
    Ba = (RL * RW) / (CD * CW),
    IBR = BL * 100 / HG,
    PI = ((SH + RH) / 2) / SH,
    IC = HW * 100 / HL,
    BR = SH / RH,
    TD = HG / SH
  ) 
```
ğŸ“‰ 4. Stepwise Discriminant Analysisï¼ˆé€æ­¥åˆ¤åˆ«åˆ†æï¼‰
```{r }
library(MASS)
quant_vars <- data %>%
  #select(where(is.numeric)) %>%
  dplyr::select(-ID_troup,-ID_animal,-Vegz,-Loc
)  # å¯æ ¹æ®éœ€è¦æ’é™¤æŸäº›å˜é‡

# æ·»åŠ åˆ†ç»„ä¿¡æ¯
quant_vars$PHZ <- as.factor(data$PHZ)

# ä½¿ç”¨ stepwise LDAï¼ˆå¯è‡ªå®šä¹‰å˜é‡é€‰æ‹©ï¼‰
lda_fit <- lda(PHZ ~ ., data = quant_vars)


plot(predict(lda_fit)$x, col = quant_vars$PHZ, pch = 19,
     main = "Canonical Discriminant Analysis (CDA)")
```
ğŸŒ³ 5. Ascending Hierarchical Clusteringï¼ˆAHCï¼‰
```{r }
library(cluster)
library(factoextra)

# æ•°æ®æ ‡å‡†åŒ–
#scaled_data <- scale(quant_vars[, -ncol(quant_vars)])

# è·ç¦»çŸ©é˜µ & å±‚æ¬¡èšç±»
d <- dist(quant_vars)
hc <- hclust(d, method = "ward.D2")

# æ ‘çŠ¶å›¾
plot(hc, labels = FALSE, main = "Hierarchical Clustering Dendrogram")
```
ğŸ¯ 6. Multiple Correspondence Analysisï¼ˆMCAï¼‰
ç”¨äºå®šæ€§å˜é‡ï¼ˆå¦‚æ¯›è‰²ã€è€³å‹ç­‰ï¼‰
```{r }
library(FactoMineR)
library(factoextra)

qual_vars <- data %>%
  dplyr::select( CC, HL, EO, BP) %>%
  mutate_all(as.factor)

mca_res <- MCA(qual_vars, graph = FALSE)
fviz_mca_biplot(mca_res, repel = TRUE)
```
